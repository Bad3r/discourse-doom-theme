<script type="text/discourse-plugin" version="0.9">
  $(document).ajaxSuccess(function () {
    // Hide :before element for tags with an icon.
    $('.discourse-tag.bullet .tag-icon').each(function() {
      $(this).parent().addClass('has-icon');
    });
  });
</script>

<script type="text/x-handlebars" data-template-name="list/posters-column.raw">
  <td class='topic-list-data poster-list'>
    <div class="posters">
    {{#each posters as |poster|}}
      {{#if poster.moreCount}}
        <a class="posters-more-count">{{poster.moreCount}}</a>
      {{else}}
        <a href="{{poster.user.path}}"
           data-user-card="{{poster.user.username}}"
           class="{{poster.extraClasses}}">
          {{avatar poster
            avatarTemplatePath="user.avatar_template"
            usernamePath="user.username"
            namePath="user.name"
            imageSize="60"}}</a>
      {{/if}}
    {{/each}}
    </div>
  </td>
</script>

<script type="text/x-handlebars" data-template-name="topic-list-header.raw">
  {{~raw-plugin-outlet name="topic-list-header-before"~}}
  {{#if bulkSelectEnabled}}
    <th class="bulk-select">
      {{#if canBulkSelect}}
        {{raw "flat-button" class="bulk-select" icon="list" title="topics.bulk.toggle"}}
      {{/if}}
    </th>
  {{/if}}
  {{raw "topic-list-header-column" order='default' name=listTitle bulkSelectEnabled=bulkSelectEnabled showBulkToggle=toggleInTitle canBulkSelect=canBulkSelect canDoBulkActions=canDoBulkActions}}
  {{#if showLikes}}
    {{raw "topic-list-header-column" sortable=sortable number='true' order='likes' name='likes'}}
  {{/if}}
  {{!--
    {{#if showOpLikes}}
      {{raw "topic-list-header-column" sortable=sortable number='true' order='op_likes' name='likes'}}
    {{/if}}
    {{raw "topic-list-header-column" sortable=sortable number='true' order='views' name='views'}}
    {{raw "topic-list-header-column" sortable=sortable number='true' order='posts' forceName='Replies'}}
  --}}
  <th class="topic-list-data hideme"></th>
  {{raw "topic-list-header-column" sortable=sortable number='true' order='activity' name='activity'}}
  {{~raw-plugin-outlet name="topic-list-header-after"~}}
</script>


<script type="text/x-handlebars" data-template-name="list/topic-list-item.hbr">
  {{~raw-plugin-outlet name="topic-list-before-columns"}}

  {{#if bulkSelectEnabled}}
    <td class="bulk-select topic-list-data">
      <label for="bulk-select-{{topic.id}}">
        <input type="checkbox" class="bulk-select" id="bulk-select-{{topic.id}}">
      </label>
    </td>
  {{/if}}

  <td class='main-link clearfix topic-list-data' colspan="1">
    {{~raw-plugin-outlet name="topic-list-before-link"}}
    <span class='link-top-line'>
      {{~raw-plugin-outlet name="topic-list-before-status"}}
      {{~raw "topic-status" topic=topic}}
      {{~topic-link topic class="raw-link raw-topic-link"}}
      {{~#if topic.featured_link}}
        {{~topic-featured-link topic}}
      {{~/if}}
      {{~raw-plugin-outlet name="topic-list-after-title"}}
      {{~raw "list/unread-indicator"
        includeUnreadIndicator=includeUnreadIndicator
        topicId=topic.id
        unreadClass=unreadClass~}}
      {{~#if showTopicPostBadges}}
        {{~raw "topic-post-badges" unreadPosts=topic.unread_posts unseen=topic.unseen url=topic.lastUnreadUrl newDotText=newDotText}}
      {{~/if}}
    </span>

    <div class="link-bottom-line">
      {{#unless hideCategory}}
        {{#unless topic.isPinnedUncategorized}}
          {{~raw-plugin-outlet name="topic-list-before-category"}}
          {{category-link topic.category}}
        {{/unless}}
      {{/unless}}
      {{discourse-tags topic mode="list" tagsForUser=tagsForUser}}
      {{raw "list/action-list" topic=topic postNumbers=topic.liked_post_numbers className="likes" icon="heart"}}
    </div>

    {{#if expandPinned}}
      {{raw "list/topic-excerpt" topic=topic}}
    {{/if}}

    <div class="topic-meta-data">
      <div class="num topic-list-data views {{topic.viewsHeat}}">
        {{d-icon "far-eye"}} {{number topic.views numberKey="views_long"}}
      </div>

      {{#if topic.replyCount}}
        <div class="num topic-list-data posts-map posts {{topic.likesHeat}}" title="{{topic.title}}">
          <button class="btn-link posts-map badge-posts {{topic.likesHeat}}">
            {{raw-plugin-outlet name="topic-list-before-reply-count"}}
            {{d-icon "far-comment"}}
            {{number topic.replyCount noTitle="true" ariaLabel=topic.title}}
          </button>
        </div>
      {{/if}}

      {{#if hasLikes}}
        <div class="num topic-list-data likes">
          <a href='{{topic.summaryUrl}}'>
            {{d-icon "heart"}} {{number topic.like_count}}
          </a>
        </div>
      {{/if}}

      {{#if showOpLikes}}
        <div class="num topic-list-data likes">
          {{#if hasOpLikes}}
          <a href='{{topic.summaryUrl}}'>
            {{d-icon "heart"}} {{number topic.op_like_count}}
          </a>
          {{/if}}
        </div>
      {{/if}}
    </div>
  </td>

  {{#if showPosters}}
    {{raw "list/posters-column" posters=topic.featuredUsers }}
  {{/if}}

  <td class="num topic-list-data {{cold-age-class topic.createdAt startDate=topic.bumpedAt class=""}} activity" title="{{html-safe topic.bumpedAtTitle}}">
    <a class="post-activity" href="{{topic.lastPostUrl}}">
      {{~raw-plugin-outlet name="topic-list-before-relative-date"~}}
      {{~format-date topic.bumpedAt format="tiny" noTitle="true"~}}
    </a>
  </td>
</script>
